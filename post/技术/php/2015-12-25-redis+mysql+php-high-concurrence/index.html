<!DOCTYPE html>
<html lang="zh-CN">
    <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="generator" content="Hugo 0.121.2">

    

    

    
        
            <meta name="description" content="redis队列缓存 &#43; mysql 批量入库 &#43; php离线整合" />
        

        
            <meta
                name="keywords"
                content="hugo,site,new" />
        

        
            <meta
                name="author"
                content="Jing Wang" />
        

    


    <title>
        
            【高并发简单解决方案】redis队列缓存 &#43; mysql 批量入库 &#43; php离线整合 |
            My New Hugo Site
        
    </title>

    


    
    

    
    


    
    


    
    


    
    

    


    
    

    

    

        
        


        
        


        <link
            rel="stylesheet"
            href="/css/index_d751713.min.912d03bce61461ecbc3ca083479e1ed814bba94df76d0bdc6aa88fdca33621b9bb410dc2c81af31e8101fec62decfa5f6e48901ad673bc5056d2f1d1f2368a34.css"
            integrity="sha512-kS0DvOYUYey8PKCDR54e2BS7qU33bQvcaqiP3KM2Ibm7QQ3CyBrzHoEB/sYt7PpfbkiQGtZzvFBW0vHR8jaKNA==" />
    


    
    

    

    

    

    
</head>



    <body>
        <header class="header">
    <div class="header_left">
        
    </div>

    <div class="header_middle">
        
            【高并发简单解决方案】redis队列缓存 &#43; mysql 批量入库 &#43; php离线整合 -
            My New Hugo Site
        
    </div>
</header>



        <main>
            <aside class="sidebar">
    



    
    

    
    


    <ul class="section-tree">
        
            
                <li
                    
                        class="dir opened-dir"
                    >
                    <span class="dir-text"> Posts </span>

                    



    
    

    
    


    <ul class="section-tree">
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/llm/2024-06-18-learn-lang-chain/" title="./post/%E6%8A%80%E6%9C%AF/llm/2024-06-18-learn-lang-chain/">
                        
                            手把手教你认识学会LangChain
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/llm/2024-06-18-text-to-vec/" title="./post/%E6%8A%80%E6%9C%AF/llm/2024-06-18-text-to-vec/">
                        
                            文本向量化
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/linux/2018-05-25-cron-session-log/" title="./post/%E6%8A%80%E6%9C%AF/linux/2018-05-25-cron-session-log/">
                        
                            session opened/closed for user root by (uid=0)
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/php/2017-07-17-anonymous-function/" title="./post/%E6%8A%80%E6%9C%AF/php/2017-07-17-anonymous-function/">
                        
                            PHP代码之使用匿名函数
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/php/2017-07-17-use-/" title="./post/%E6%8A%80%E6%9C%AF/php/2017-07-17-use-/">
                        
                            PHP代码之使用引用
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/php/2017-07-17-interface/" title="./post/%E6%8A%80%E6%9C%AF/php/2017-07-17-interface/">
                        
                            PHP类的接口`interface`
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/php/2017-06-23-composer-exceeded-time/" title="./post/%E6%8A%80%E6%9C%AF/php/2017-06-23-composer-exceeded-time/">
                        
                            Composer错误：exceeded the timeout of 300 seconds
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/php/2017-06-13-switch-between-multiple-php-version-on-ubuntu/" title="./post/%E6%8A%80%E6%9C%AF/php/2017-06-13-switch-between-multiple-php-version-on-ubuntu/">
                        
                            Ubuntu上在多个PHP版本之间切换
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/php/2017-04-01-php-recursion-memory-problem/" title="./post/%E6%8A%80%E6%9C%AF/php/2017-04-01-php-recursion-memory-problem/">
                        
                            递归时内存占用问题
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/mysql/2016-11-22-ubuntu-mysql-connect/" title="./post/%E6%8A%80%E6%9C%AF/mysql/2016-11-22-ubuntu-mysql-connect/">
                        
                            解决Ubuntu远程连接mysql连不上的问题
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/2016-11-01-shell-dos-fault/" title="./post/%E6%8A%80%E6%9C%AF/2016-11-01-shell-dos-fault/">
                        
                            Linux下执行shell提示错误syntax error:unexpected end of file
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/2016-09-29-mbp-router-wifi/" title="./post/%E6%8A%80%E6%9C%AF/2016-09-29-mbp-router-wifi/">
                        
                            Macbook pro连接无线路由不稳定掉线的解决办法
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/2015-05-11-ajax-cross-domain-with-cookies/" title="./post/%E6%8A%80%E6%9C%AF/2015-05-11-ajax-cross-domain-with-cookies/">
                        
                            Ajax跨域请求带上cookies
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/git/2016-04-14-git-bash-change-initial-directory/" title="./post/%E6%8A%80%E6%9C%AF/git/2016-04-14-git-bash-change-initial-directory/">
                        
                            Git Bash 更改初始目录
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/2016-04-14-skype-port-80/" title="./post/%E6%8A%80%E6%9C%AF/2016-04-14-skype-port-80/">
                        
                            Skype打开默认占用80端口问题
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E8%8D%89%E7%A8%BF/2016-03-30-some-questions-met/" title="./post/%E8%8D%89%E7%A8%BF/2016-03-30-some-questions-met/">
                        
                            面试中遇到的一些问题总结
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E8%8D%89%E7%A8%BF/2016-03-29-svn-git-diff/" title="./post/%E8%8D%89%E7%A8%BF/2016-03-29-svn-git-diff/">
                        
                            svn与git的一些区别
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/2016-03-16-memcache/" title="./post/%E6%8A%80%E6%9C%AF/2016-03-16-memcache/">
                        
                            Memcache整理
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/php/2016-03-04-php-encrypt-method/" title="./post/%E6%8A%80%E6%9C%AF/php/2016-03-04-php-encrypt-method/">
                        
                            几种常见的PHP加密算法
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E8%8D%89%E7%A8%BF/2016-03-02-dangerously-set-innerhtml/" title="./post/%E8%8D%89%E7%A8%BF/2016-03-02-dangerously-set-innerhtml/">
                        
                            React学习 之 Dangerously Set innerHTML
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/javascript/2016-03-01-useragent-is-weixin-browser/" title="./post/%E6%8A%80%E6%9C%AF/javascript/2016-03-01-useragent-is-weixin-browser/">
                        
                            微信内置浏览器UserAgent的判断
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E8%8D%89%E7%A8%BF/2016-02-29-mac-composer-install-problem/" title="./post/%E8%8D%89%E7%A8%BF/2016-02-29-mac-composer-install-problem/">
                        
                            Mac下安装composer遇到的问题
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/linux/2015-12-29-shell-check-server/" title="./post/%E6%8A%80%E6%9C%AF/linux/2015-12-29-shell-check-server/">
                        
                            自动检测程序正常运行，遇故障则重启服务
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/php/2015-12-25-redis&#43;mysql&#43;php-high-concurrence/" title="./post/%E6%8A%80%E6%9C%AF/php/2015-12-25-redis&#43;mysql&#43;php-high-concurrence/">
                        
                            【高并发简单解决方案】redis队列缓存 &#43; mysql 批量入库 &#43; php离线整合
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/php/2015-12-25-php-timing-task/" title="./post/%E6%8A%80%E6%9C%AF/php/2015-12-25-php-timing-task/">
                        
                            PHP设置定时任务的实现方法
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/php/2015-12-25-ip-to-address/" title="./post/%E6%8A%80%E6%9C%AF/php/2015-12-25-ip-to-address/">
                        
                            根据ip查询所在地
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/2015-12-23-preg-start/" title="./post/%E6%8A%80%E6%9C%AF/2015-12-23-preg-start/">
                        
                            正则表达式基础语法
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/2015-12-21-awesome-machine-learning/" title="./post/%E6%8A%80%E6%9C%AF/2015-12-21-awesome-machine-learning/">
                        
                            Awesome Machine Learning
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E7%94%9F%E6%B4%BB/2015-12-18-100-years-of-beauty/" title="./post/%E7%94%9F%E6%B4%BB/2015-12-18-100-years-of-beauty/">
                        
                            100 Years of Beauty
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/javascript/2015-12-18-javascript-array-function/" title="./post/%E6%8A%80%E6%9C%AF/javascript/2015-12-18-javascript-array-function/">
                        
                            Javascript各种数组方法
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/mysql/2015-12-17-mysql-update-varies-value/" title="./post/%E6%8A%80%E6%9C%AF/mysql/2015-12-17-mysql-update-varies-value/">
                        
                            mysql批量更新多条记录的不同值
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/php/2015-12-17-php-files-directory/" title="./post/%E6%8A%80%E6%9C%AF/php/2015-12-17-php-files-directory/">
                        
                            php获取文件夹下所有文件，包含子文件夹
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/php/2015-12-16-php-run-time/" title="./post/%E6%8A%80%E6%9C%AF/php/2015-12-16-php-run-time/">
                        
                            PHP调试执行时间
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/2015-12-06-win10-pid4-system/" title="./post/%E6%8A%80%E6%9C%AF/2015-12-06-win10-pid4-system/">
                        
                            win10下80端口被PID为4的System占用问题
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/php/2015-12-15-shortcut-save-url/" title="./post/%E6%8A%80%E6%9C%AF/php/2015-12-15-shortcut-save-url/">
                        
                            收藏到桌面的快捷方式
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/htmlcss/2015-12-10-ui-elements/" title="./post/%E6%8A%80%E6%9C%AF/htmlcss/2015-12-10-ui-elements/">
                        
                            各种常见的UI元素
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/jquery/2014-12-08-jquery-plugin/" title="./post/%E6%8A%80%E6%9C%AF/jquery/2014-12-08-jquery-plugin/">
                        
                            jQuery插件开发笔记
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/2015-12-06-shell-method-terminal/" title="./post/%E6%8A%80%E6%9C%AF/2015-12-06-shell-method-terminal/">
                        
                            执行系统命令的函数
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/2015-12-03-jekyll-template-grammer/" title="./post/%E6%8A%80%E6%9C%AF/2015-12-03-jekyll-template-grammer/">
                        
                            Jekyll模板变量&amp;语法
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/php/2015-12-03-php-zip-so/" title="./post/%E6%8A%80%E6%9C%AF/php/2015-12-03-php-zip-so/">
                        
                            测试phpexcel后报错Class &#39;ZipArchive&#39; not found解决方法
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/jquery/2015-12-02-jquery-plugin-template/" title="./post/%E6%8A%80%E6%9C%AF/jquery/2015-12-02-jquery-plugin-template/">
                        
                            jQuery插件模板
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/php/2015-12-02-memcache/" title="./post/%E6%8A%80%E6%9C%AF/php/2015-12-02-memcache/">
                        
                            Memcache基本教程
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/2014-12-01-one-line-browser-notepad/" title="./post/%E6%8A%80%E6%9C%AF/2014-12-01-one-line-browser-notepad/">
                        
                            一行代码，浏览器变临时编辑器
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/php/2015-12-01-php-zend_search_lucene-cn-search/" title="./post/%E6%8A%80%E6%9C%AF/php/2015-12-01-php-zend_search_lucene-cn-search/">
                        
                            使用PHP&#43;Zend_Search_Lucene做全站中文搜索引擎
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/mysql/2015-11-26-mysql-rand-n-row/" title="./post/%E6%8A%80%E6%9C%AF/mysql/2015-11-26-mysql-rand-n-row/">
                        
                            从Mysql某一表中随机读取n条数据的SQL查询语句
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/2015-11-19-data-hiding-in-image/" title="./post/%E6%8A%80%E6%9C%AF/2015-11-19-data-hiding-in-image/">
                        
                            用图片隐藏信息的技术实现
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E5%85%B6%E4%BB%96/2015-11-02-all-country-list/" title="./post/%E5%85%B6%E4%BB%96/2015-11-02-all-country-list/">
                        
                            全部国家列表
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E5%85%B6%E4%BB%96/2015-11-02-all-api/" title="./post/%E5%85%B6%E4%BB%96/2015-11-02-all-api/">
                        
                            各种API
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/php/2015-10-29-curl-login/" title="./post/%E6%8A%80%E6%9C%AF/php/2015-10-29-curl-login/">
                        
                            curl模拟登陆
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/2015-10-27-msvcr100u-dll/" title="./post/%E6%8A%80%E6%9C%AF/2015-10-27-msvcr100u-dll/">
                        
                            如何解决msvcr100.dll丢失问题
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/jquery/2015-10-21-jquery-little-method/" title="./post/%E6%8A%80%E6%9C%AF/jquery/2015-10-21-jquery-little-method/">
                        
                            常用的jQuery小技巧
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/php/2015-10-14-php-is-mobile/" title="./post/%E6%8A%80%E6%9C%AF/php/2015-10-14-php-is-mobile/">
                        
                            PHP 判断设备是否是手机/平板的方法
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/php/2015-10-10-simple-factory-mode/" title="./post/%E6%8A%80%E6%9C%AF/php/2015-10-10-simple-factory-mode/">
                        
                            PHP设计模式之简单工厂模式
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/php/2015-10-10-php-simple-methods/" title="./post/%E6%8A%80%E6%9C%AF/php/2015-10-10-php-simple-methods/">
                        
                            简单实用的PHP函数
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/2015-10-09-firefox-mason/" title="./post/%E6%8A%80%E6%9C%AF/2015-10-09-firefox-mason/">
                        
                            Firefox域名重定向插件——Mason
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/php/2015-10-09-php-singleton-pattern/" title="./post/%E6%8A%80%E6%9C%AF/php/2015-10-09-php-singleton-pattern/">
                        
                            PHP设计模式之单例模式
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/php/2015-09-21-phpexcel/" title="./post/%E6%8A%80%E6%9C%AF/php/2015-09-21-phpexcel/">
                        
                            PHPExcel类库的各种使用方法总结
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/laravel/2015-09-01-laravel-build/" title="./post/%E6%8A%80%E6%9C%AF/laravel/2015-09-01-laravel-build/">
                        
                            【laravel学习笔记】一、安装
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/laravel/2015-09-11-laravel-route-controller-view/" title="./post/%E6%8A%80%E6%9C%AF/laravel/2015-09-11-laravel-route-controller-view/">
                        
                            【laravel学习笔记】二、路由、控制器及视图简介
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/2015-09-01-git-do/" title="./post/%E6%8A%80%E6%9C%AF/2015-09-01-git-do/">
                        
                            git常用的一些命令
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/linux/2015-08-31-linux-5/" title="./post/%E6%8A%80%E6%9C%AF/linux/2015-08-31-linux-5/">
                        
                            Linux中cp直接覆盖不提示的方法
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/htmlcss/2015-08-20-div-float/" title="./post/%E6%8A%80%E6%9C%AF/htmlcss/2015-08-20-div-float/">
                        
                            解决子级float浮动父级无高度没有自适应问题
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/linux/2015-03-19-linux-vi-editor/" title="./post/%E6%8A%80%E6%9C%AF/linux/2015-03-19-linux-vi-editor/">
                        
                            linux之vi编辑器命令使用
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/bootstrap/2015-03-26-bootstrap/" title="./post/%E6%8A%80%E6%9C%AF/bootstrap/2015-03-26-bootstrap/">
                        
                            bootstrap笔记
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/linux/2015-03-19-linux-1/" title="./post/%E6%8A%80%E6%9C%AF/linux/2015-03-19-linux-1/">
                        
                            linux批量替换字符串
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/linux/2015-03-19-linux-2/" title="./post/%E6%8A%80%E6%9C%AF/linux/2015-03-19-linux-2/">
                        
                            Linux服务器间文件传输
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/linux/2015-03-19-linux-tar-zip/" title="./post/%E6%8A%80%E6%9C%AF/linux/2015-03-19-linux-tar-zip/">
                        
                            打包/压缩目录
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/2015-02-28-sublime-text/" title="./post/%E6%8A%80%E6%9C%AF/2015-02-28-sublime-text/">
                        
                            Sublime Text Snippets(代码片段)功能
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/htmlcss/2015-01-01-scroller/" title="./post/%E6%8A%80%E6%9C%AF/htmlcss/2015-01-01-scroller/">
                        
                            自定义滚动条样式
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/2015-01-30-markdown/" title="./post/%E6%8A%80%E6%9C%AF/2015-01-30-markdown/">
                        
                            标准的markdown格式练习
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/2015-01-01-github-blog/" title="./post/%E6%8A%80%E6%9C%AF/2015-01-01-github-blog/">
                        
                            使用Github Pages建独立博客
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/2015-01-01-jekyll/" title="./post/%E6%8A%80%E6%9C%AF/2015-01-01-jekyll/">
                        
                            安装Jekyll
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/htmlcss/2014-01-01-css/" title="./post/%E6%8A%80%E6%9C%AF/htmlcss/2014-01-01-css/">
                        
                            css笔记
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/jquery/2014-01-01-jquery/" title="./post/%E6%8A%80%E6%9C%AF/jquery/2014-01-01-jquery/">
                        
                            jQuery笔记
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/javascript/2014-01-01-js/" title="./post/%E6%8A%80%E6%9C%AF/javascript/2014-01-01-js/">
                        
                            js笔记
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/php/2014-01-01-php/" title="./post/%E6%8A%80%E6%9C%AF/php/2014-01-01-php/">
                        
                            php知识笔记
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/thinkphp/2014-01-01-thinkphp/" title="./post/%E6%8A%80%E6%9C%AF/thinkphp/2014-01-01-thinkphp/">
                        
                            ThinkPHP笔记
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/linux/2014-01-01-linux/" title="./post/%E6%8A%80%E6%9C%AF/linux/2014-01-01-linux/">
                        
                            各种常用的Linux操作命令
                        
                    </a>
                </li>
            
        
    </ul>


                </li>
            
        
    </ul>


</aside>
<aside class="exapandable"></aside>


            
    <article class="main">
        <button
    class="sidebar-toggle-btn"
    type="menu"
    aria-expanded="false"
    aria-haspopup="true">
    <i class="bi bi-list"></i>
</button>



        <div class="title">
            <h1 class="title-header">
                【高并发简单解决方案】redis队列缓存 &#43; mysql 批量入库 &#43; php离线整合
            </h1>

            <div class="author-date-readtime">
                

                    
                        <div class="author" title="Author">
                            <i class="bi bi-person"></i>
                            <a
                                href="/author/jing-wang/"
                                class="cat-btn">
                                Jing Wang
                            </a>
                        </div>
                    

                

                
                    <div class="date" title="Date">
                        <i class="bi bi-calendar3"></i>
                        <time
                            datetime="2015.12.25"
                            >2015.12.25
                        </time>
                    </div>
                

                
                    <div
                        class="readtime"
                        title="Time to Read">
                        <i class="bi bi-clock"></i>
                        2 mins to read
                    </div>
                
            </div>
        </div>

        <div class="article-meta">
            
                <div class="categories">
                    <i
                        class="bi bi-bookmarks"
                        title="Categories"></i>
                    
                        <a
                            href="/categories/php/"
                            class="cat-btn">
                            PHP
                        </a>
                    
                </div>
            

            
                <div class="tags">
                    <i
                        class="bi bi-tags"
                        title="Tags"></i>
                    
                        <a
                            href="/tags/php/"
                            class="tag-btn">
                            php
                        </a>
                    
                        <a
                            href="/tags/redis/"
                            class="tag-btn">
                            redis
                        </a>
                    
                        <a
                            href="/tags/mysql/"
                            class="tag-btn">
                            mysql
                        </a>
                    
                        <a
                            href="/tags/%E9%AB%98%E5%B9%B6%E5%8F%91/"
                            class="tag-btn">
                            高并发
                        </a>
                    
                </div>
            

            
                <div class="breadcumb">
                    <i class="bi bi-folder"></i>
                    
    
    




<a href="https://gongvirgil.github.io/" class="bread-btn">
    
        <i class="bi bi-house-fill"></i>
    

    
        Home
    
</a>




    /



<a href="https://gongvirgil.github.io/post/" class="bread-btn">
    

    
        Posts
    
</a>




    /



<a href="https://gongvirgil.github.io/post/%E6%8A%80%E6%9C%AF/php/2015-12-25-redis&#43;mysql&#43;php-high-concurrence/" class="bread-btn">
    

    
        
            【高并发简单解决方案】redis队列缓存 &#43; mysql 批量入库 &#43; php离线整合
        

    
</a>

                </div>
            

            
        </div>

        
            <nav id="TableOfContents"></nav>
        


        <div class="content">
            
                <p>需求背景：有个调用统计日志存储和统计需求，要求存储到mysql中；存储数据高峰能达到日均千万，瓶颈在于直接入库并发太高，可能会把mysql干垮。</p>
<p>问题分析</p>
<p>思考：应用网站架构的衍化过程中，应用最新的框架和工具技术固然是最优选择；但是，如果能在现有的框架的基础上提出简单可依赖的解决方案，未尝不是一种提升自我的尝试。</p>
<p>解决：</p>
<ul>
<li>问题一：要求日志最好入库；但是，直接入库mysql确实扛不住，批量入库没有问题，done。【批量入库和直接入库性能差异参考文章】</li>
<li>问题二：批量入库就需要有高并发的消息队列，决定采用redis list 仿真实现，而且方便回滚。</li>
<li>问题三：日志量毕竟大，保存最近30条足矣，决定用php写个离线统计和清理脚本。</li>
</ul>
<p>done，下面是小拽的简单实现过程</p>
<!-- raw HTML omitted -->
<p>##一：设计数据库表和存储</p>
<pre><code>考虑到log系统对数据库的性能更多一些，稳定性和安全性没有那么高，存储引擎自然是只支持select insert 没有索引的archive。如果确实有update需求，也可以采用myISAM。

考虑到log是实时记录的所有数据，数量可能巨大，主键采用bigint，自增即可。

考虑到log系统以写为主，统计采用离线计算，字段均不要出现索引，因为一方面可能会影响插入数据效率，另外读时候会造成死锁，影响写数据。
</code></pre>
<p>##二：redis存储数据形成消息队列</p>
<p>由于高并发，尽可能简单，直接，上代码。</p>
<pre><code>&lt;?php
/***************************************************************************
*
* 获取到的调用日志，存入redis的队列中.
* $Id$
*
**************************************************************************/

/**
* @file saveLog.php
* @date 2015/11/06 20:47:13
* @author:cuihuan
* @version $Revision$
* @brief
*
**/

// 获取info
$interface_info = $_GET['info'];

// 存入redis队列
$redis = new Redis();
$redis-&gt;connect('xx', 6379);
$redis-&gt;auth(&quot;password&quot;);

// 加上时间戳存入队列
$now_time = date(&quot;Y-m-d H:i:s&quot;);
$redis-&gt;rPush(&quot;call_log&quot;, $interface_info . &quot;%&quot; . $now_time);
$redis-&gt;close();


/* vim: set ts=4 sw=4 sts=4 tw=100 */
?&gt;
</code></pre>
<p>##三：数据定时批量入库。</p>
<p>定时读取redis消息队列里面的数据，批量入库。</p>
<pre><code>&lt;?php
/**
 * 获取redis消息队列中的脚本，拼接sql，批量入库。
 * @update 2015-11-07 添加失败消息队列回滚机制 
 *
 * @Author:cuihuan
 * 2015-11-06
 * */

// init redis
$redis_xx = new Redis();
$redis_xx-&gt;connect('ip', port);
$redis_xx-&gt;auth(&quot;password&quot;);

// 获取现有消息队列的长度
$count = 0;
$max = $redis_xx-&gt;lLen(&quot;call_log&quot;);

// 获取消息队列的内容，拼接sql
$insert_sql = &quot;insert into fb_call_log (`interface_name`, `createtime`) values &quot;;

// 回滚数组
$roll_back_arr = array();

while ($count &lt; $max) {
    $log_info = $redis_cq01-&gt;lPop(&quot;call_log&quot;);
    $roll_back_arr = $log_info;
    if ($log_info == 'nil' || !isset($log_info)) {
        $insert_sql .= &quot;;&quot;;
        break;
    }

    // 切割出时间和info
    $log_info_arr = explode(&quot;%&quot;,$log_info);
    $insert_sql .= &quot; ('&quot;.$log_info_arr[0].&quot;','&quot;.$log_info_arr[1].&quot;'),&quot;;
    $count++;
}

// 判定存在数据，批量入库
if ($count != 0) {
    $link_2004 = mysql_connect('ip:port', 'user', 'password');
    if (!$link_2004) {
        die(&quot;Could not connect:&quot; . mysql_error());
    }

    $crowd_db = mysql_select_db('fb_log', $link_2004);
    $insert_sql = rtrim($insert_sql,&quot;,&quot;).&quot;;&quot;;
    $res = mysql_query($insert_sql);

    // 输出入库log和入库结果;
    echo date(&quot;Y-m-d H:i:s&quot;).&quot;insert &quot;.$count.&quot; log info result:&quot;;
    echo json_encode($res);
    echo &quot;&lt;br&gt;\n&quot;;
    
    // 数据库插入失败回滚
    if(!$res){
       foreach($roll_back_arr as $k){
           $redis_xx-&gt;rPush(&quot;call_log&quot;, $k);
       }
    }
 
    // 释放连接
    mysql_free_result($res);
    mysql_close($link_2004);
}

// 释放redis
$redis_cq01-&gt;close();
?&gt;
</code></pre>
<p>##四：离线天级统计和清理数据脚本</p>
<pre><code>&lt;?php
/**
* static log ：每天离线统计代码日志和删除五天前的日志
*
* @Author:cuihuan
* 2015-11-06
* */

// 离线统计
$link_2004 = mysql_connect('ip:port', 'user', 'pwd');
if (!$link_2004) {
    die(&quot;Could not connect:&quot; . mysql_error());
}

$crowd_db = mysql_select_db('fb_log', $link_2004);

// 统计昨天的数据
$day_time = date(&quot;Y-m-d&quot;, time() - 60 * 60 * 24 * 1);
$static_sql = &quot;get sql&quot;;

$res = mysql_query($static_sql, $link_2004);

// 获取结果入库略

// 清理15天之前的数据
$before_15_day = date(&quot;Y-m-d&quot;, time() - 60 * 60 * 24 * 15);
$delete_sql = &quot;delete from xxx where createtime &lt; '&quot; . $before_15_day . &quot;'&quot;;
try {
    $res = mysql_query($delete_sql);
}catch(Exception $e){
    echo json_encode($e).&quot;\n&quot;;
    echo &quot;delete result:&quot;.json_encode($res).&quot;\n&quot;;
}

mysql_close($link_2004);
?&gt;
</code></pre>
<p>##五：代码部署</p>
<p>主要是部署，批量入库脚本的调用和天级统计脚本，crontab例行运行。</p>
<p>###批量入库脚本</p>
<pre><code>*/2 * * * * /home/cuihuan/xxx/lamp/php5/bin/php /home/cuihuan/xxx/batchLog.php &gt;&gt;/home/cuihuan/xxx/batchlog.log
</code></pre>
<p>###天级统计脚本</p>
<pre><code>0 5 * * * /home/cuihuan/xxx/php5/bin/php /home/cuihuan/xxx/staticLog.php &gt;&gt;/home/cuihuan/xxx/staticLog.log
</code></pre>
<p>总结：相对于其他复杂的方式处理高并发，这个解决方案简单有效：通过redis缓存抗压，mysql批量入库解决数据库瓶颈，离线计算解决统计数据，通过定期清理保证库的大小。</p>
<blockquote>
<p>原文作者：<a href="http://segmentfault.com/a/1190000004136250">靠谱崔小拽</a></p>
</blockquote>
<blockquote>
<p>原文地址：<a href="http://segmentfault.com/a/1190000004136250">高并发简单解决方案</a></p>
</blockquote>

            
        </div>
    </article>

        </main>

        <footer class="footer">
    <div class="footer-left">
        <ul class="social">
            
                <li>All Rights Reserved ®.</li>
            

            
                <li>Jing Wang</li>
            

            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
        </ul>
    </div>

    <div class="footer-right">
        <ul class="control status clearfix">
            
                <li>
                    
                        Word Count:
                        351
                    
                </li>
            

            
            

            
                <li>en</li>
            

            
                <li>
                    <a href="https://gohugo.io" class="btn" target="_blank"
                        >Hugo: 0.121.2</a
                    >
                </li>
            

            
                <li>
                    <a
                        href="https://github.com/JingWangTW/dark-theme-editor"
                        class="btn"
                        target="_blank"
                        >Theme: dark-theme-editor</a
                    >
                </li>
            

            
                <li>
                    
                        Last modified: &nbsp;
                        <time>
                            Dec 25 2015 00:00:00
                        </time>
                    
                </li>
            

            
                <li title="">
                    
                </li>
            
        </ul>
    </div>
</footer>

    </body>

    























    
    


    
    


    <script
        type="text/javascript"
        src="/js/index_d751713.min.5eeb120f16ea146352725c420364f87befead45f678142b8f0ffbef024646931fbc06bff07a7bd6cb57fa2f8cd8a21ba6a4ee5a278ec32303a378bc1cd17f246.js"
        integrity="sha512-XusSDxbqFGNSclxCA2T4e&#43;/q1F9ngUK48P&#43;&#43;8CRkaTH7wGv/B6e9bLV/ovjNiiG6ak7lonjsMjA6N4vBzRfyRg=="></script>














<link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" />




</html>
